# QMS-Nexus 前后端接口一致性检查报告

> 生成时间：2026-02-15
> 检查范围：后端路由 vs 前端服务 vs API文档

---

## 📊 接口对比总览

| 模块 | 后端已实现 | 前端调用 | API文档 | 状态 |
|------|-----------|---------|---------|------|
| 健康检查 | 1 | 1 | 1 | ✅ 一致 |
| 文件上传 | 2 | 2 | 2 | ✅ 一致 |
| 语义检索 | 1 | 1 | 1 | ✅ 一致 |
| RAG问答 | 1 | 1 | 1 | ✅ 一致 |
| 标签管理 | 4 | 8 | 4 | ⚠️ 前端超调 |
| 系统管理 | 16 | 16 | 3 | ⚠️ 文档缺失 |
| 文档管理 | 0 | 13 | 0 | ❌ 全部缺失 |
| 问答历史 | 0 | 5 | 0 | ❌ 全部缺失 |

---

## ✅ 已对齐的接口

### 1. 文件上传模块

| 方法 | 路径 | 说明 |
|------|------|------|
| POST | `/upload` | 上传文件 |
| GET | `/upload/status/{task_id}` | 查询任务状态 |

**修复记录**：
- [x] 前端 `upload.ts`：`/tasks/{taskId}` → `/upload/status/{taskId}` ✅

### 2. 标签管理模块

| 方法 | 路径 | 后端 | 前端 | 文档 |
|------|------|------|------|------|
| GET | `/tags` | ✅ | ✅ | ✅ |
| POST | `/tags` | ✅ | ✅ | ✅ |
| PUT | `/tags/{tag}` | ✅ | ✅ | ✅ |
| DELETE | `/tags/{tag}` | ✅ | ✅ | ✅ |

### 3. 系统管理模块

| 方法 | 路径 | 后端 | 前端 | 说明 |
|------|------|------|------|------|
| GET | `/system/status` | ✅ | ✅ | 获取系统状态 |
| GET | `/system/config` | ✅ | ✅ | 获取系统配置 |
| PUT | `/config` | ✅ | ✅ | 更新系统配置 |
| GET | `/system/stats` | ✅ | ✅ | 获取统计信息 |

**修复记录**：
- [x] 前端 `system.ts`：`/system/config` → `/config` ✅

---

## ⚠️ 前端调用但后端未实现的接口

### 标签模块（4个）

| 方法 | 前端路径 | 用途 | 优先级 |
|------|----------|------|--------|
| POST | `/tags/batch/add` | 批量添加文档标签 | P2 |
| POST | `/tags/batch/remove` | 批量移除文档标签 | P2 |
| GET | `/tags/:id/documents` | 获取标签下的文档 | P2 |
| GET | `/tags/search` | 搜索标签 | P3 |

### 文档模块（13个）❌ 全部缺失

| 方法 | 前端路径 | 用途 | 优先级 |
|------|----------|------|--------|
| POST | `/documents` | 创建文档 | P2 |
| GET | `/documents` | 获取文档列表 | P1 |
| GET | `/documents/:id` | 获取单个文档 | P1 |
| DELETE | `/documents/:id` | 删除文档 | P2 |
| DELETE | `/documents` | 批量删除 | P2 |
| PUT | `/documents/:id/tags` | 更新文档标签 | P2 |
| GET | `/documents/:id/download` | 下载文档 | P2 |
| GET | `/documents/:id/preview` | 预览文档 | P2 |
| GET | `/documents/:id/related` | 获取相关文档 | P3 |
| GET | `/documents/stats` | 文档统计 | P2 |
| PUT | `/documents/batch/status` | 批量更新状态 | P3 |
| PUT | `/documents/batch/tags` | 批量更新标签 | P3 |

### 问答历史模块（5个）❌ 全部缺失

| 方法 | 前端路径 | 用途 | 优先级 |
|------|----------|------|--------|
| GET | `/chat/history` | 获取问答历史 | P3 |
| POST | `/chat/conversations` | 保存对话 | P3 |
| GET | `/chat/conversations` | 对话列表 | P3 |
| GET | `/chat/conversations/:id` | 对话详情 | P3 |
| DELETE | `/chat/conversations/:id` | 删除对话 | P3 |

---

## ❌ API契约文档与实际不一致

### 问题1：任务状态查询路径

| 来源 | 路径 |
|------|------|
| API契约文档 | `GET /tasks/{task_id}` |
| 后端实际实现 | `GET /upload/status/{task_id}` |
| 当前前端 | `GET /upload/status/{task_id}` ✅ |

**建议**：更新 API契约文档，以实际实现为准。

### 问题2：契约文档缺少大量接口

API契约文档仅定义了基础接口，缺失：
- 系统管理接口（13个）
- 文档管理接口（13个）
- 问答历史接口（5个）

---

## 🔧 建议修复方案

### 方案A：精简前端（推荐短期）

**只保留后端已实现的接口调用**：
1. 注释/删除前端对缺失接口的调用
2. 隐藏相关UI功能按钮
3. 添加 "功能开发中" 提示

### 方案B：后端补全接口（推荐长期）

**按优先级实现缺失接口**：
1. **P1（核心功能）**：文档列表、文档详情
2. **P2（重要功能）**：标签批量操作、文档下载/预览
3. **P3（增强功能）**：问答历史、对话管理

### 方案C：Mock数据（推荐测试）

**前端使用Mock数据**：
- 在 `services/__mocks__/` 目录添加Mock实现
- 开发时不受后端接口限制

---

## 📝 待办清单

### 前端（已修复）
- [x] 修复 `upload.ts` 任务状态查询路径
- [x] 修复 `system.ts` 更新配置路径
- [ ] 添加缺失接口的错误处理（显示"功能开发中"）

### 后端（待实现）
- [ ] 实现文档管理模块（13个接口）
- [ ] 实现标签批量操作（4个接口）
- [ ] 实现问答历史模块（5个接口）

### 文档（待更新）
- [ ] 更新 `api-contract.md`，以实际实现为准
- [ ] 补充系统管理、文档管理接口定义

---

## 🎯 当前状态总结

| 维度 | 状态 |
|------|------|
| 核心功能（上传、搜索、问答） | ✅ 可用 |
| 标签管理 | ✅ 基础功能可用，批量操作缺失 |
| 系统状态显示 | ⚠️ 部分接口404但不影响使用 |
| 文档管理 | ❌ 不可用，全部接口缺失 |
| 问答历史 | ❌ 不可用，全部接口缺失 |

**结论**：基础功能已可用，但大量增强功能需要后端补全接口。
