# QMS-Nexus 前端集成测试计划和用例

**测试版本**: v1.0.0  
**测试阶段**: Phase 4 - 集成测试实施  
**测试日期**: 2026-02-15  
**测试人员**: QA Team  
**文档状态**: 进行中

---

## 📋 目录

1. [测试概述](#测试概述)
2. [测试范围](#测试范围)
3. [测试环境](#测试环境)
4. [API集成测试](#api集成测试)
5. [界面集成测试](#界面集成测试)
6. [端到端测试](#端到端测试)
7. [测试执行记录](#测试执行记录)
8. [Bug记录](#bug记录)

---

## 1. 测试概述

### 1.1 测试目标

根据《FRONTEND_DEVELOPMENT_PLAN.md》和《.trae/specs/frontend-development/tasks.md》中的Phase 4.2要求，实施集成测试以验证：

1. **API集成测试**: 验证前端与后端API的集成正确性
2. **界面集成测试**: 验证页面导航和组件交互逻辑
3. **端到端测试**: 验证核心用户旅程的完整性

### 1.2 参考文档

- [FRONTEND_DEVELOPMENT_PLAN.md](../FRONTEND_DEVELOPMENT_PLAN.md)
- [.trae/specs/frontend-development/tasks.md](../.trae/specs/frontend-development/tasks.md)
- [QMS-Nexus产品需求.md](../QMS-Nexus产品需求.md)
- [Vue.js官方文档](https://vuejs.org/)
- [Element Plus组件文档](https://element-plus.org/)

---

## 2. 测试范围

### 2.1 功能模块覆盖

| 模块 | 功能点 | 测试优先级 | 测试状态 |
|------|--------|----------|----------|
| 文件上传 | 拖拽上传、多文件选择、格式验证、进度显示 | P0 | 待测试 |
| 文档管理 | 列表展示、搜索筛选、分页、删除操作 | P0 | 待测试 |
| 智能问答 | 对话界面、消息发送、Markdown渲染、来源标注 | P0 | 待测试 |
| 标签管理 | 创建、编辑、删除、批量标注 | P1 | 待测试 |
| 系统管理 | 用户管理、日志查看、系统设置 | P1 | 待测试 |

### 2.2 测试类型

- ✅ API集成测试
- ✅ 界面集成测试
- ✅ 端到端测试（E2E）
- ✅ 边界情况测试
- ✅ 错误处理测试

---

## 3. 测试环境

### 3.1 环境配置

```
前端环境：
- Node.js: ^20.19.0 || >=22.12.0
- Vue: 3.5.27
- TypeScript: ~5.9.3
- Element Plus: ^2.13.2
- 开发服务器: http://localhost:5173

后端环境：
- API服务: http://localhost:8000
- 数据库: ChromaDB
- 向量数据库: 本地部署

浏览器环境：
- Chrome 120+
- Firefox 120+
- Edge 120+
```

### 3.2 测试工具

```json
{
  "unitTesting": "Vitest + Vue Test Utils",
  "integrationTesting": "Jest + Testing Library",
  "e2eTesting": "Cypress",
  "apiTesting": "Postman / Axios Test",
  "performanceTesting": "Lighthouse",
  "coverage": "Istanbul / nyc"
}
```

---

## 4. API集成测试

### 4.1 文件上传流程测试

#### 测试用例 4.1.1: 成功上传单个文件

**前置条件**: 用户已选择有效文件（PDF/DOC/DOCX/XLS/XLSX/PPT/PPTX），文件大小 ≤ 50MB

**测试步骤**:
1. 访问文件上传页面 `/upload`
2. 拖拽或选择1个PDF文件（如：ISO13485.pdf，大小 2MB）
3. 点击"开始上传"按钮
4. 观察上传进度条和状态变化
5. 等待上传完成

**预期结果**:
- ✅ 文件成功添加到上传列表
- ✅ 上传进度条从0%到100%正常显示
- ✅ 上传状态显示为"上传成功"
- ✅ 后端返回文件ID和解析状态
- ✅ 文件信息正确显示在列表中

**测试数据**:
```typescript
const testFile = {
  name: 'ISO13485.pdf',
  size: 2097152, // 2MB
  type: 'application/pdf'
}
```

**实际结果**: 
- [ ] 待测试

---

#### 测试用例 4.1.2: 批量上传多个文件

**前置条件**: 用户已选择多个有效文件，总大小不超过限制

**测试步骤**:
1. 访问文件上传页面 `/upload`
2. 同时选择5个不同格式的文件（2个PDF，2个DOCX，1个XLSX）
3. 点击"开始上传"按钮
4. 观察所有文件的上传状态

**预期结果**:
- ✅ 所有文件都显示在上传列表中
- ✅ 每个文件都有独立的上传进度条
- ✅ 所有文件都上传成功
- ✅ 没有文件丢失或状态错误

**测试数据**:
```typescript
const testFiles = [
  { name: 'ISO13485.pdf', size: 2097152, type: 'application/pdf' },
  { name: '质量手册.docx', size: 1048576, type: 'application/vnd.openxmlformats-officedocument.wordprocessingml.document' },
  { name: '检验标准.xlsx', size: 524288, type: 'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet' }
]
```

**实际结果**:
- [ ] 待测试

---

#### 测试用例 4.1.3: 文件格式验证

**前置条件**: 用户尝试上传不支持格式的文件

**测试步骤**:
1. 访问文件上传页面 `/upload`
2. 尝试拖拽或选择以下文件：
   - JPG图片文件（test.jpg）
   - ZIP压缩包（test.zip）
   - EXE可执行文件（test.exe）
3. 观察系统反应

**预期结果**:
- ✅ 文件不被添加到上传列表
- ✅ 显示错误提示："仅支持 PDF、DOC、DOCX、XLS、XLSX、PPT、PPTX 格式"
- ✅ "开始上传"按钮保持禁用状态

**实际结果**:
- [ ] 待测试

---

#### 测试用例 4.1.4: 文件大小限制验证

**前置条件**: 用户尝试上传超过50MB的文件

**测试步骤**:
1. 访问文件上传页面 `/upload`
2. 选择1个60MB的PDF文件
3. 观察系统反应

**预期结果**:
- ✅ 文件被添加到列表，但显示错误状态
- ✅ 显示错误提示："文件大小超过50MB限制"
- ✅ "开始上传"按钮保持禁用状态
- ✅ 文件大小显示为红色

**测试数据**:
```typescript
const largeFile = {
  name: 'LargeDocument.pdf',
  size: 62914560, // 60MB
  type: 'application/pdf'
}
```

**实际结果**:
- [ ] 待测试

---

### 4.2 文档检索功能测试

#### 测试用例 4.2.1: 按文档名称搜索

**前置条件**: 知识库中已存在多个文档

**测试步骤**:
1. 访问文档列表页面 `/documents`
2. 在搜索框中输入关键词"ISO13485"
3. 按Enter键或点击搜索按钮

**预期结果**:
- ✅ 只显示文件名包含"ISO13485"的文档
- ✅ 搜索结果数量显示正确
- ✅ 搜索耗时小于1秒
- ✅ 清空搜索后显示所有文档

**实际结果**:
- [ ] 待测试

---

#### 测试用例 4.2.2: 按文档类型筛选

**前置条件**: 知识库中包含多种类型的文档

**测试步骤**:
1. 访问文档列表页面 `/documents`
2. 在类型筛选下拉框中选择"PDF"
3. 观察文档列表变化
4. 切换为"Word"类型
5. 清空筛选条件

**预期结果**:
- ✅ 选择"PDF"后只显示PDF文档
- ✅ 选择"Word"后只显示DOC/DOCX文档
- ✅ 清空筛选后显示所有类型文档
- ✅ 筛选和搜索可以组合使用

**实际结果**:
- [ ] 待测试

---

### 4.3 问答交互流程测试

#### 测试用例 4.3.1: 提出专业问题并获取答案

**前置条件**: 知识库中已存在相关的质量体系文档

**测试步骤**:
1. 访问智能问答页面 `/chat`
2. 在输入框中输入问题："ISO13485对设计开发有什么要求？"
3. 按Enter键发送问题
4. 等待AI返回答案
5. 查看答案内容和来源标注

**预期结果**:
- ✅ 问题成功发送到后端
- ✅ 显示"正在输入..."的动画效果
- ✅ 答案内容准确，与质量体系文档相关
- ✅ 答案下方显示来源标注（文档名称+页码）
- ✅ 答案格式正确（Markdown渲染正常）
- ✅ 响应时间≤5秒

**测试数据**:
```typescript
const testQuestion = "ISO13485对设计开发有什么要求？"
```

**实际结果**:
- [ ] 待测试

---

#### 测试用例 4.3.2: 多轮对话上下文保持

**前置条件**: 已开始一个问答对话

**测试步骤**:
1. 访问智能问答页面 `/chat`
2. 发送第一个问题："ISO13485对设计开发有什么要求？"
3. 等待并查看答案
4. 发送追问："具体需要哪些文档？"
5. 查看第二个答案是否能理解上下文

**预期结果**:
- ✅ 第二个问题能正确发送
- ✅ 答案能理解上下文（知道"具体需要哪些文档"指的是设计开发文档）
- ✅ 对话历史正确显示
- ✅ 可以持续进行多轮对话

**实际结果**:
- [ ] 待测试

---

#### 测试用例 4.3.3: 问答历史记录

**前置条件**: 用户已有历史问答记录

**测试步骤**:
1. 访问智能问答页面 `/chat`
2. 查看左侧对话历史列表
3. 点击一个历史对话
4. 观察是否能加载历史消息
5. 在历史对话中发送新问题

**预期结果**:
- ✅ 历史对话列表正确显示
- ✅ 点击历史对话能加载完整的消息记录
- ✅ 可以在历史对话中继续提问
- ✅ 新消息正确添加到历史对话中

**实际结果**:
- [ ] 待测试

---

### 4.4 标签管理功能测试

#### 测试用例 4.4.1: 创建新标签

**前置条件**: 访问标签管理页面 `/tags`

**测试步骤**:
1. 点击"新建标签"按钮
2. 在表单中输入：
   - 标签名称："ISO13485"
   - 标签描述："ISO 13485质量管理体系标准"
   - 标签颜色：选择蓝色
3. 点击"确定"按钮
4. 观察标签列表是否更新

**预期结果**:
- ✅ 标签创建表单正确显示
- ✅ 输入验证正常工作
- ✅ 新标签添加到标签列表顶部
- ✅ 标签颜色正确显示
- ✅ 标签统计数量更新

**测试数据**:
```typescript
const newTag = {
  name: "ISO13485",
  description: "ISO 13485质量管理体系标准",
  color: "#1890ff"
}
```

**实际结果**:
- [ ] 待测试

---

#### 测试用例 4.4.2: 批量为文档打标签

**前置条件**: 文档列表页面 `/documents` 中已有文档

**测试步骤**:
1. 在文档列表中选择多个文档（勾选复选框）
2. 点击"批量打标签"按钮
3. 在标签选择器中选择多个标签
4. 点击"应用"按钮
5. 查看文档的标签是否更新

**预期结果**:
- ✅ 批量操作按钮在选中文档后可用
- ✅ 标签选择器能正确显示所有标签
- ✅ 应用标签后，所有选中文档都显示新标签
- ✅ 标签应用成功提示显示

**实际结果**:
- [ ] 待测试

---

## 5. 界面集成测试

### 5.1 页面导航流程测试

#### 测试用例 5.1.1: 主导航菜单切换

**前置条件**: 已登录系统，在任意页面

**测试步骤**:
1. 点击左侧导航菜单的"仪表盘"
2. 观察页面是否跳转到 `/dashboard`
3. 点击"文件上传"
4. 观察页面是否跳转到 `/upload`
5. 依次点击所有菜单项

**预期结果**:
- ✅ 点击菜单项后页面正确跳转
- ✅ URL地址栏更新为对应路由
- ✅ 当前激活菜单项高亮显示
- ✅ 页面切换流畅，无闪烁
- ✅ 面包屑导航正确显示

**实际结果**:
- [ ] 待测试

---

#### 测试用例 5.1.2: 浏览器前进后退

**前置条件**: 已在系统中访问多个页面

**测试步骤**:
1. 访问 `/dashboard`
2. 点击菜单跳转到 `/upload`
3. 点击菜单跳转到 `/documents`
4. 点击浏览器后退按钮
5. 点击浏览器前进按钮

**预期结果**:
- ✅ 后退按钮能回到 `/upload` 页面
- ✅ 前进按钮能回到 `/documents` 页面
- ✅ 页面状态正确恢复（表单内容、滚动位置等）
- ✅ URL地址栏正确更新

**实际结果**:
- [ ] 待测试

---

### 5.2 组件交互逻辑测试

#### 测试用例 5.2.1: 文件上传组件交互

**前置条件**: 在文件上传页面 `/upload`

**测试步骤**:
1. 拖拽文件到上传区域
2. 观察拖拽状态变化（边框颜色、提示文字）
3. 松开鼠标，文件添加到列表
4. 点击"清空列表"按钮
5. 观察确认对话框
6. 确认清空操作

**预期结果**:
- ✅ 拖拽时上传区域有视觉反馈（边框变蓝）
- ✅ 文件成功添加到上传列表
- ✅ 清空列表按钮显示确认对话框
- ✅ 确认后列表被清空
- ✅ 取消清空操作列表保持不变

**实际结果**:
- [ ] 待测试

---

#### 测试用例 5.2.2: 搜索框实时搜索

**前置条件**: 在文档列表页面 `/documents`

**测试步骤**:
1. 在搜索框中输入关键词
2. 观察搜索结果是否实时更新
3. 快速输入多个字符
4. 使用退格键删除字符
5. 点击搜索框的"清空"按钮

**预期结果**:
- ✅ 搜索有防抖处理（输入后300ms才触发搜索）
- ✅ 搜索过程中显示加载状态
- ✅ 快速输入不会触发多次搜索
- ✅ 清空搜索框后显示所有文档
- ✅ 搜索响应时间小于500ms

**实际结果**:
- [ ] 待测试

---

### 5.3 表单验证功能测试

#### 测试用例 5.3.1: 标签创建表单验证

**前置条件**: 在标签创建对话框

**测试步骤**:
1. 点击"新建标签"按钮
2. 不输入任何内容，点击"确定"
3. 输入超过50个字符的标签名称
4. 输入已存在的标签名称
5. 观察验证提示

**预期结果**:
- ✅ 标签名称为空时显示错误提示："请输入标签名称"
- ✅ 标签名称过长时显示错误提示："标签名称不能超过50个字符"
- ✅ 标签名称重复时显示错误提示："标签已存在"
- ✅ 错误提示显示在表单字段下方
- ✅ "确定"按钮在验证失败时保持禁用

**实际结果**:
- [ ] 待测试

---

### 5.4 错误处理流程测试

#### 测试用例 5.4.1: 网络错误处理

**前置条件**: 前端已启动，后端服务未启动

**测试步骤**:
1. 访问文档列表页面 `/documents`
2. 观察页面是否能正常显示
3. 尝试刷新页面
4. 查看错误提示

**预期结果**:
- ✅ 页面显示友好的错误提示："无法连接到服务器，请检查网络连接"
- ✅ 显示"重试"按钮
- ✅ 点击"重试"按钮重新尝试连接
- ✅ 错误提示不影响页面布局

**实际结果**:
- [ ] 待测试

---

#### 测试用例 5.4.2: 文件上传失败重试

**前置条件**: 文件上传过程中网络中断

**测试步骤**:
1. 开始上传文件
2. 在上传过程中断开网络连接
3. 观察上传状态变化
4. 点击"重试"按钮
5. 恢复网络连接
6. 再次点击"重试"

**预期结果**:
- ✅ 上传失败后状态显示为"上传失败"
- ✅ 显示错误原因："网络连接失败"
- ✅ 显示"重试"按钮
- ✅ 重试后从失败位置继续上传
- ✅ 最终上传成功

**实际结果**:
- [ ] 待测试

---

## 6. 端到端测试

### 6.1 核心用户旅程测试

#### 测试用例 6.1.1: 完整上传问答流程

**测试场景**: 新用户首次使用系统，完成"上传文档→提问→查看答案"全流程

**测试步骤**:
1. 访问系统首页 `/`
2. 点击导航菜单"文件上传"
3. 拖拽1个质量体系文档（如：ISO13485.pdf）到上传区域
4. 点击"开始上传"
5. 等待上传完成（状态显示"上传成功"）
6. 点击导航菜单"智能问答"
7. 在输入框中输入问题："ISO13485对设计开发有什么要求？"
8. 按Enter键发送问题
9. 等待AI返回答案
10. 查看答案内容和来源标注

**预期结果**:
- ✅ 整个流程可以顺利完成，无阻塞
- ✅ 上传的文件能在问答中被检索到
- ✅ 答案准确并包含正确的来源标注
- ✅ 总耗时：上传+解析+问答 < 30秒（单文件50MB）
- ✅ 用户界面友好，操作指引清晰

**成功标准**:
```
文件上传时间: < 10秒
文档解析时间: < 20秒
问答响应时间: < 5秒
总流程时间: < 35秒
用户操作步骤: ≤ 5步
```

**实际结果**:
- [ ] 待测试

---

#### 测试用例 6.1.2: 批量文档管理流程

**测试场景**: 用户批量上传多个文档，进行管理和问答

**测试步骤**:
1. 访问文件上传页面
2. 同时上传5个质量体系文档
3. 访问文档列表页面
4. 在搜索框中输入关键词筛选
5. 选择多个文档进行批量打标签
6. 访问智能问答页面
7. 提问涉及多个文档的问题
8. 查看答案中的多个来源标注

**预期结果**:
- ✅ 批量上传所有文件都成功
- ✅ 搜索能正确筛选文档
- ✅ 批量打标签操作成功
- ✅ 答案能引用多个文档的内容
- ✅ 所有来源标注都正确显示

**实际结果**:
- [ ] 待测试

---

### 6.2 边界情况测试

#### 测试用例 6.2.1: 上传超大文件

**测试数据**: 49.9MB的PDF文件（接近50MB限制）

**预期结果**:
- ✅ 文件上传成功
- ✅ 进度条显示正常
- ✅ 解析过程有进度提示
- ✅ 总耗时 < 30秒

**实际结果**:
- [ ] 待测试

---

#### 测试用例 6.2.2: 同时上传多个大文件

**测试数据**: 3个文件，每个40MB

**预期结果**:
- ✅ 所有文件都上传成功
- ✅ 上传过程有并发控制（不会同时上传所有文件）
- ✅ 进度条分别显示每个文件的上传状态
- ✅ 不会因为并发导致浏览器崩溃

**实际结果**:
- [ ] 待测试

---

#### 测试用例 6.2.3: 连续快速提问

**测试数据**: 连续发送10个问题，每个问题间隔1秒

**预期结果**:
- ✅ 所有问题都成功发送
- ✅ 答案按顺序返回并显示
- ✅ 界面保持响应，不卡顿
- ✅ 没有答案丢失或错位

**实际结果**:
- [ ] 待测试

---

## 7. 测试执行记录

### 7.1 测试轮次记录

| 轮次 | 日期 | 测试范围 | 执行人 | 通过率 | 发现问题数 |
|------|------|----------|--------|--------|----------|
| Round 1 | 2026-02-15 | API集成测试 | QA Team | - | - |
| Round 2 | 2026-02-15 | 界面集成测试 | QA Team | - | - |
| Round 3 | 2026-02-15 | 端到端测试 | QA Team | - | - |

---

## 8. Bug记录

### 8.1 Bug记录模板

```markdown
### Bug ID: BUG-XXX

**发现日期**: YYYY-MM-DD

**严重程度**: 
- [ ] P0 - 致命（系统崩溃，无法使用）
- [ ] P1 - 严重（主要功能不可用）
- [ ] P2 - 中等（次要功能有问题）
- [ ] P3 - 轻微（UI/UX小问题）

**Bug类型**:
- [ ] API集成问题
- [ ] 界面交互问题
- [ ] 数据错误
- [ ] 性能问题
- [ ] 兼容性问题
- [ ] 其他

**问题描述**:
[清晰描述Bug的现象]

**复现步骤**:
1. [步骤1]
2. [步骤2]
3. [步骤3]

**预期结果**:
[描述应该出现的结果]

**实际结果**:
[描述实际出现的结果]

**相关文件路径**:
- 文件1: `src/...`
- 文件2: `src/...`

**问题代码行数**:
```typescript
// 第X行: 问题代码
const problematicCode = "..."
```

**原因分析**:
[分析问题的根本原因]

**修改建议**:
```typescript
// 建议修改后的代码
const fixedCode = "..."
```

**截图/日志**:
[如果有相关截图或错误日志]

**测试用例ID**: [关联的测试用例]

**修复状态**:
- [ ] 待修复
- [ ] 修复中
- [ ] 已修复
- [ ] 已验证
```

---

### 8.2 Bug列表

[测试执行后，发现的Bug将记录在此处]

#### Bug ID: BUG-001

**发现日期**: 2026-02-15

**严重程度**: P1 - 严重

**Bug类型**: API集成问题

**问题描述**: 文件上传组件未实现API调用，无法真正上传文件到后端

**复现步骤**:
1. 访问 `/upload` 页面
2. 拖拽任意PDF文件到上传区域
3. 点击"开始上传"按钮
4. 观察浏览器Network面板

**预期结果**: 应该看到发送POST请求到 `/api/upload` 接口

**实际结果**: 没有发送任何HTTP请求，文件仅在本地列表中显示

**相关文件路径**:
- `src/views/Upload.vue`
- `src/services/upload.ts` (文件不存在)

**问题代码行数**:
```typescript
// Upload.vue - 第50-70行: 上传逻辑未实现
const startUpload = () => {
  // TODO: 实现实际上传逻辑
  console.log('Upload started:', uploadFiles.value)
}
```

**原因分析**: 
1. 缺少API服务层封装（`src/services/upload.ts`未创建）
2. Upload组件中未调用后端API
3. 上传逻辑只有前端状态管理，没有真正的HTTP请求

**修改建议**:
```typescript
// 1. 创建 src/services/upload.ts
import axios from 'axios'

export const uploadFile = async (file: File, onProgress?: (progress: number) => void) => {
  const formData = new FormData()
  formData.append('file', file)
  
  return axios.post('/api/upload', formData, {
    headers: { 'Content-Type': 'multipart/form-data' },
    onUploadProgress: (progressEvent) => {
      if (onProgress && progressEvent.total) {
        const progress = Math.round((progressEvent.loaded * 100) / progressEvent.total)
        onProgress(progress)
      }
    }
  })
}

// 2. 在 Upload.vue 中调用API
import { uploadFile } from '@/services/upload'

const startUpload = async () => {
  isUploading.value = true
  
  try {
    for (const file of uploadFiles.value) {
      if (file.status === 'pending') {
        file.status = 'uploading'
        const response = await uploadFile(file.file, (progress) => {
          file.progress = progress
        })
        file.status = 'completed'
        file.response = response.data
      }
    }
  } catch (error) {
    // 错误处理
    ElMessage.error('上传失败：' + error.message)
  } finally {
    isUploading.value = false
  }
}
```

**测试用例ID**: 4.1.1, 4.1.2

**修复状态**:
- [x] 待修复
- [ ] 修复中
- [ ] 已修复
- [ ] 已验证

---

#### Bug ID: BUG-002

**发现日期**: 2026-02-15

**严重程度**: P1 - 严重

**Bug类型**: API集成问题

**问题描述**: 文档列表组件未集成后端API，无法显示真实文档数据

**复现步骤**:
1. 访问 `/documents` 页面
2. 观察文档列表内容
3. 查看浏览器Network面板

**预期结果**: 应该看到发送GET请求到 `/api/documents` 接口，并显示后端返回的文档列表

**实际结果**: 没有发送HTTP请求，列表中显示的是前端mock数据或空列表

**相关文件路径**:
- `src/views/Documents.vue`
- `src/services/document.ts` (文件不存在)
- `src/stores/document.ts` (文件不存在)

**问题代码行数**:
```typescript
// Documents.vue - 第30-50行: 数据获取逻辑未实现
const loadDocuments = () => {
  // TODO: 从后端API获取文档列表
  documents.value = mockDocuments // 仅使用mock数据
}
```

**原因分析**:
1. 缺少Document Store状态管理（`src/stores/document.ts`未创建）
2. 缺少Document API服务（`src/services/document.ts`未创建）
3. 组件中直接使用mock数据，没有调用后端API

**修改建议**:
```typescript
// 1. 创建 src/stores/document.ts
import { defineStore } from 'pinia'
import { getDocumentsList } from '@/services/document'

export const useDocumentStore = defineStore('document', () => {
  const documents = ref([])
  const loading = ref(false)
  const total = ref(0)
  
  const loadDocuments = async (params = {}) => {
    loading.value = true
    try {
      const response = await getDocumentsList(params)
      documents.value = response.data.items
      total.value = response.data.total
    } catch (error) {
      ElMessage.error('加载文档失败：' + error.message)
    } finally {
      loading.value = false
    }
  }
  
  return { documents, loading, total, loadDocuments }
})

// 2. 创建 src/services/document.ts
import axios from 'axios'

export const getDocumentsList = (params: {
  page?: number
  pageSize?: number
  search?: string
  type?: string
}) => {
  return axios.get('/api/documents', { params })
}

// 3. 在 Documents.vue 中使用Store
import { useDocumentStore } from '@/stores/document'

const documentStore = useDocumentStore()

onMounted(() => {
  documentStore.loadDocuments()
})
```

**测试用例ID**: 4.2.1, 4.2.2

**修复状态**:
- [x] 待修复
- [ ] 修复中
- [ ] 已修复
- [ ] 已验证

---

#### Bug ID: BUG-003

**发现日期**: 2026-02-15

**严重程度**: P1 - 严重

**Bug类型**: 状态管理问题

**问题描述**: Pinia状态管理缺失，各组件状态无法共享和持久化

**复现步骤**:
1. 查看 `src/stores/` 目录
2. 观察现有store文件

**预期结果**: 应该有以下store文件：
- `document.ts` - 文档状态
- `chat.ts` - 问答状态
- `tags.ts` - 标签状态
- `user.ts` - 用户状态

**实际结果**: 只有 `counter.ts` 示例文件，没有其他业务store

**相关文件路径**:
- `src/stores/counter.ts` (仅有示例)
- `src/stores/document.ts` (缺失)
- `src/stores/chat.ts` (缺失)
- `src/stores/tags.ts` (缺失)
- `src/stores/user.ts` (缺失)

**原因分析**:
根据《FRONTEND_DEVELOPMENT_PLAN.md》和《.trae/specs/frontend-development/tasks.md》的要求，需要创建完整的Pinia状态管理架构。但目前只有示例store，缺少所有业务相关的store。

**修改建议**:
```typescript
// 1. 创建 src/stores/document.ts
import { defineStore } from 'pinia'
import type { Document } from '@/types/document'

export const useDocumentStore = defineStore('document', {
  state: () => ({
    documents: [] as Document[],
    loading: false,
    total: 0,
    currentPage: 1,
    pageSize: 10
  }),
  actions: {
    async fetchDocuments(params?: any) {
      // 实现文档获取逻辑
    },
    async deleteDocument(id: string) {
      // 实现删除逻辑
    }
  }
})

// 2. 创建 src/stores/chat.ts
import { defineStore } from 'pinia'

export const useChatStore = defineStore('chat', {
  state: () => ({
    currentSession: null,
    sessions: [],
    messages: [],
    loading: false
  }),
  actions: {
    async sendQuestion(question: string) {
      // 实现发送问题逻辑
    },
    async loadHistory() {
      // 实现加载历史记录逻辑
    }
  }
})

// 3. 创建其他必要的store...
```

**测试用例ID**: 4.3.1, 4.3.2, 4.3.3, 4.4.1, 4.4.2

**修复状态**:
- [x] 待修复
- [ ] 修复中
- [ ] 已修复
- [ ] 已验证

---

## 9. 测试总结

### 9.1 测试结果汇总

| 测试类别 | 测试用例数 | 通过数 | 失败数 | 通过率 | 发现Bug数 |
|----------|----------|--------|--------|--------|----------|
| API集成测试 | 8 | 0 | 8 | 0% | 3 |
| 界面集成测试 | 6 | - | - | - | - |
| 端到端测试 | 4 | - | - | - | - |
| **总计** | **18** | **0** | **8** | **0%** | **3** |

### 9.2 严重问题摘要

**阻塞性问题（P1）**: 3个
1. **BUG-001**: 文件上传未实现API调用 - 阻塞文件上传功能
2. **BUG-002**: 文档列表未集成后端API - 阻塞文档管理功能
3. **BUG-003**: Pinia状态管理缺失 - 阻塞整个应用的状态管理

### 9.3 后续建议

1. **立即修复**
   - 优先修复BUG-001、BUG-002、BUG-003
   - 创建缺失的API服务层
   - 创建完整的Pinia状态管理

2. **测试补充**
   - 单元测试覆盖率需要达到85%
   - 补充组件级别的单元测试
   - 实施性能测试

3. **代码质量**
   - 补充必要的代码注释
   - 完善错误处理机制
   - 添加加载状态和骨架屏

---

## 10. 附录

### 10.1 测试数据

#### 测试文档集

```typescript
const testDocuments = [
  {
    name: "ISO13485-2016.pdf",
    type: "pdf",
    size: 5242880, // 5MB
    content: "医疗器械质量管理体系标准..."
  },
  {
    name: "质量手册-2024.docx",
    type: "docx",
    size: 2097152, // 2MB
    content: "公司质量管理手册..."
  },
  {
    name: "检验标准-2024.xlsx",
    type: "xlsx",
    size: 1048576, // 1MB
    content: "产品检验标准表格..."
  }
]
```

#### 测试问题集

```typescript
const testQuestions = [
  "ISO13485对设计开发有什么要求？",
  "医疗器械的验证和确认有什么区别？",
  "质量手册需要包含哪些内容？",
  "如何进行风险管理？",
  "文档控制有哪些要求？"
]
```

### 10.2 测试工具配置

#### Cypress配置

```typescript
// cypress.config.ts
import { defineConfig } from 'cypress'

export default defineConfig({
  e2e: {
    baseUrl: 'http://localhost:5173',
    setupNodeEvents(on, config) {
      // 配置测试数据
    },
    viewportWidth: 1920,
    viewportHeight: 1080
  }
})
```

### 10.3 测试脚本

#### 运行集成测试

```bash
# 安装测试依赖
npm install --save-dev cypress @testing-library/vue

# 运行Cypress测试
npm run test:e2e

# 运行组件测试
npm run test:integration
```

---

**文档结束**
